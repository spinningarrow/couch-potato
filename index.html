<title>TV List</title>
<form onsubmit="handleSearchSubmitted(event)">
  <input id="search" type="search" />
  <button type="submit">Search</button>
</form>

<div id="results"></div>

<div id="react-app"></div>

<script
  src="https://unpkg.com/react@18/umd/react.development.js"
  crossorigin
></script>
<script
  src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
  crossorigin
></script>

<script type="module">
  import * as api from "./api.mjs";

  const e = React.createElement;

  class LikeButton extends React.Component {
    constructor(props) {
      super(props);
      this.state = { liked: false };
    }

    render() {
      if (this.state.liked) {
        return "You liked this.";
      }

      return e(
        "button",
        { onClick: () => this.setState({ liked: true }) },
        "Like"
      );
    }
  }

  const SearchForm = ({ handleSearch }) => {
    return e(
      "form",
      { onSubmit: handleSearch },
      e("input", { type: "search" }),
      e("button", { type: "submit" }, "Search")
    );
  };

  const SearchResult = ({ id, image } ) => {
    return e("span", { }, e('img', {
    src: image?.medium || image?.original || 'https://via.placeholder.com/200x300',
    title: id
    }));
  };

  const SearchResults = ({results}) => {
    return e(
      "div",
      {},
      (results || []).map(result => e(SearchResult, { key: result.id, ...result }))
    );
  };

  const App = (props) => {
    const [results, setResults] = React.useState([])

    return e(
      "div",
      {},
      e(SearchForm, {
        handleSearch: async (event) => {
          event.preventDefault();
          const query = event.target.elements[0].value;
          console.log("query was", query);

          const results = await api.search(query);
          console.log('search results', results)
          setResults(results)

          return false;
        },
      }),
      e(SearchResults, { results }),
      e(LikeButton)
    );
  };

  const domContainer = document.querySelector("#react-app");
  const root = ReactDOM.createRoot(domContainer);
  root.render(e(App));
</script>

<script>
  const SEARCH_API_URL = "https://api.tvmaze.com/search/shows?q=";
  const handleSearchSubmitted = async (event) => {
    event.preventDefault();

    const query = event.target.elements.namedItem("search").value;
    console.log(query);

    const response = await fetch(
      `${SEARCH_API_URL}${encodeURIComponent(query)}`
    );
    const json = await response.json();
    console.log(json);

    const imageUrls = json.map(
      (result) =>
        result.show.image?.medium ||
        result.show.image?.original ||
        "https://via.placeholder.com/200x300"
    );

    const html = imageUrls.map((url) => `<img src="${url}">`).join("\n");
    document.querySelector("#results").innerHTML = html;

    return false;
  };
</script>
